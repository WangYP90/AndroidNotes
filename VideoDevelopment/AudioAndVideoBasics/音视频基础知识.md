# 音视频基础知识
该教程没有一张图片
## 基础概念
- ***媒体***：是表示，传输，存储信息的载体，常人们见到的文字、声音、图像、图形、等都是表示信息的媒体。
- ***多媒体***：是声音、动画、文字、图像和录像等各种媒体的结合，以图文并茂，生动活泼的动态形式表现出来，给人以很强的视觉冲击力，留下深刻印象。
- ***流媒体***： 流媒体是指采用流式传输的方式在`Internet` 播放的连续时基媒体格式,实际指的是一种新的媒体传送方式,而不是一种新的媒体格式(在网络上传输音/视频等多媒体信息现在主要有下载和流式传输两种方式)流式传输分两种方法:实时流式传输方式(`Realtime Streaming`)和顺序流式传输方式(`Progressive Streaming`)。
- ***多媒体文件***： 是既包括视频又包括音频，甚至还带有脚本的一个集合，也可以叫容器。
- ***媒体编码***： 是文件当中的视频和音频所采用的压缩算法。`以avi格式为例,avi是Micorsoft于1992年11月作为其Video for Windows软件的一部分引入的多媒体容器格式. 而avi的支持多种音/视频编码格式。`
- ***码率***： 码率就是数据传输时单位时间传送的数据位数，一般我们用的单位是`kbps`即千位每秒。通俗一点的理解就是取样率，单位时间内取样率越大，精度就越高，处理出来的文件就越接近原始文件，但是文件体积与取样率是成正比的，所以几乎所有的编码格式重视的都是如何用最低的码率达到最少的失真。但是因为编码算法不一样，所以也不能用码率来统一衡量音质或者画质。
- ***帧率***： 帧/秒(`frames per second`)的缩写帧率即每秒显示帧数,帧率表示图片处理器处理场时每秒钟能够更新的次数。高的帧率可以得到更流畅、更逼真的动画。一般来说`30fps` 就是可以接受的，但是将性能提升至`60fps` 则可以明显提升交互感和逼真感，但是一般来说超过`75fps`一般就不容易察觉到有明显的流畅度提升了。如果帧率超过屏幕刷新率只会浪费图形处理的能力，因为监视器不能以这么快的速度更新，这样超过新率的帧率就浪费掉了。
- ***关键帧***： 相当于二维动画中的原画，指角色或者物体运动或变化中的关键动作所处的那一帧，它包含了图像的所有信息，后来帧仅包含了改变的信息。如果你没有足够的关键帧，你的影片品质可能比较差，因为所有的帧从别的帧处产生。对于一般的用途，一个比较好的原则是每5秒设一个关键帧。但如果是那种实时传输的流文件，那么要考虑传输网络的可靠度，所以要1到2秒增加一个关键帧。
- ***刷新率***： 刷新率是指屏幕每秒画面被刷新的次数，刷新率分为垂直刷新率与水平刷新率，一般提到的刷新率通常指垂直刷新率。垂直刷新率表示屏幕上图像每秒重绘多少次，也就是每秒屏幕刷新的次数，以Hz（赫兹）为单位。刷新率越高，图像越稳定，图像显示就越自然清晰，对眼睛的影响也越小。刷新率越低，图像闪烁和抖动得就越厉害，眼睛疲劳得就越快。一般来说，如果达到80Hz以上的刷新率，就可以完全消除图像闪烁和抖动感，眼睛也不太容易疲劳。
## 流行的视频和音频标准
多个来源的视频、音频、图片和文本的组   合体通常称为多媒体。过去二十年，在电视、娱乐、互动业务、电信、会议、互联网、消费电子设备、医疗、安全、商业、交通、国防和银行等广泛的领域里，对多媒体通信的要求迅速增长。通常，因为原始数据量太大，音频和视频数据在存储或者传输之前必须要进行压缩。而且在显示或进一步处理之前压缩应能被解码。压缩也被称为编码，而解压则被称为解码。因此，压缩和解压视频/音频数据的软件或者硬件设备分别叫做视频/音频编码器和解码器。方便起见，编码器和解码器缩写为codec。

视频和音频标准系列已经由标准发展组织（SDO） 和著名公司开发出来，组织包括：
下面是维基百科的相关资料，一定要区分开视频编码格式、视频编解码器、视频封装容器格式，这几个的区别。

####  视频编码标准：
为了保证多个商家提供的软件和硬件具有互通性，下面列出一些比较一些音视频的标准组织：
1. ISO/IEC ：`国际标准化组织和国际电工委员会`
2. ITU-T: `国际电信联盟的电信标准化部门`(前CCITT)
3. SMPTE: `运动图像与电视工程师协会`
4. AVS China:` 中国的音频与视频编码标准`
5. BBC:`美国广播公司`
6. Microsoft：
7. Real Networks
8. On2 Thechnology(现在属于Google)：

下面是M.Kunt的论文1998年6月的一个视频标准表，做了微小改动。（出自视频编码全角度详解） 

标准 | 标准化团体 | 朱啊哟目标比特率|主要压缩技术|主要目标应用  
---|---|---|---|---  
JPEG|ISO/IEC|压缩比2-30|DCT、视觉量化、Z形重排序、霍夫曼编码、算术编码|互联网成像、数字摄影、图像与视频编辑
JPEG2000|ISO/IEC|压缩比2-50|小波EBCOT|互联网成像、数字摄影、图像与视频编辑、印刷、医学成像、移动应用、颜色传真、卫星成像、感兴趣区域编码，图片与艺术品数字化文库，成像素精度或分辨率的渐进传输，激光打印的渲染，印前影像
JPEG-LS第1部分与第2部分|ISO/IEC||第一部分上下文建模预测Golomb码，第二部分算术编码更有效的预测改进的Golomb码|连续色调静止图像的无损与近无损编码，连续色调静止图像的无损与近无损编码
JBIG1，JBIG2|ISO/IEC,JTC/SC23/WG1,ITU-T|JBIG1:压缩比20:1，JBIG2：压缩比高于JBIG1的2~4倍|JBIG2有损、无损以及有损到无损的图像压缩高质量渐进编码，内容渐进编码，基于内容（文本、半色调、线条稿、大字符）分解和编码基于内容的编码，软模式匹配、模式匹配、和置换二值图像编码后封装的文件格式数据（顺序访问和随机访问）| 公共存储于存档、万维网图像编码、无线数据传输、假脱机打印、远程会议、互动多媒体
JPEG-XR|ISO/IEC||基于微软的高清图片（windows 媒体图片）|连续色调摄影内容的存储于交换（有损和无损）
MPEG-1|ISO/IEC|最高达1.5Mbit/s|DCT、视觉量化、自适应量化、Z形重排序、预测运动补偿、双向运动补偿、半像素精度运动估计、霍夫曼编码、算术编码| CD-ROM存储、消费者视频、数码相机
MPEG-2|ISO/IEC|从1.5Mbit/s直到大约3.5Mbit/s|DCT、视觉量化、自适应量化、Z形重排序、预测运动补偿、双向运动补偿、基于帧/场的运动补偿、半像素精度运动估计、空城可伸缩性、质量科伸缩性、霍夫曼编码、算术编码、容错编码|数字电视、数字高清电视、高质量视频、卫星电视、有线电视、地面广播、视频编辑、视频存储、数码相机
MPEG-4 第2部分视觉|ISO/IEC|8kbit/s -大约35Mbit/s 的比特率|DCT、小波、视觉量化、自适应量化、Z形重排序、预测运动补偿、双向运动补偿、基于帧/场的运动补偿、半像素精度运动估计、高级运动估计、重叠运动补偿、空城可伸缩性、时域可扩展性、质量可扩展性、视图相关的可扩展性、位图形状编码、Sprite编码、人脸动画、动态网格编码、霍夫曼编码、算术编码、容错编码|互联网、互动视频、视觉编辑、内容操作、消费者视频、专业视频、2D/3D计算机图形
H.261|ITU-T|px 64kbit/s|DCT、视觉量化、自适应量化、Z形重排序、预测运动补偿、整数像素精度的运动估计、霍夫曼编码、容错编码| ISDN视频会议
H.262|ITU-T|比特率从1.5Mbit/s直到约35Mbit/s|DCT、视觉量化、自适应量化、Z形重排序、预测运动补偿、双向运动补偿、基于帧/场的运动补偿、半像素精度运动估计、空城可伸缩性、质量科伸缩性、霍夫曼编码、算术编码、容错编码|数字电视、数字高清电视、高质量视频、卫星电视、有线电视、地面广播、视频编辑、视频存储、数码相机
H.263、H263+和H263++|ITU-T|比特率从8Kbit/s 直到约1.5Mbit/s|DCT、视觉量化、自适应量化、Z形重排序、预测运动补偿、双向运动补偿、半像素精度运动估计、高级运动估计、重叠运动补偿、霍夫曼编码、算术编码、容错编码 | POTS可是电话、桌面可视电话、移动可视电话、视频会议
H.264/MPEG-4 第10部分|JVT（ISO/IEC和ITU-T）|比特率从8kbit/s直到150Mbit/s|整数DCT、视觉量化、自适应量化、Z形重排序、交替扫描排序、预测运动补偿、双向运动补偿、以小块进行的可变大小运动补偿、四分之一像素运动补偿、图像便捷运动矢量、多参考图像运动补偿、自适应内部方向预测、环路滤波器、算术编码（CABAC）、变长编码（CAVLC）、容错编码、跳跃模式、加权预测、Z型扫描和交替扫描、可伸缩视频编码、多视点编码 |有线广播、地面广播和卫星广播 ，光磁设备、DVD、蓝光光盘上的互动和串行存储，会话类业务、视频点播、视频流，ISDN、DSL、以太网、局域网、无线和移动网络上的MMS，高清电视、超级电视、数码相机、掌上电脑、摄录像机、Iphone、IPad、无线/手持设备，电子书阅读器、工作室分布


- 视频它是由一系列固定时间间隔拍摄的图片组成。 每秒钟的帧（图片）数叫做帧率。采样25f/s 或者30f/s是电视图像的标准；而30f/s 是正常人查看不卡顿的最低标准，60f/s 则能产生更清晰、相当平滑的运动。

视频可分为：模拟和数字类型。 
- 模拟类：比如模拟电视制式的PAL和NTSC 中的所用信号。 
- 数字类型： 
1. 数字视频由一系列图像组成，每幅图像包括M x N个像素；
2. 每个像素的颜色由RGB颜色空间或者是YCbCr空间中的三个分量确定。
3. RGB颜色空间更适合于图像采集和显示，而YCbCr空间用于编码和存储则比较好，在存储或编码之前RGB图像要转换为YCbCr图像，而YCbCr图像在显示之前通常有必要转回RGB。

* RGB、YUV、YCbCr 颜色空间的转换 

``` 
YUV和RGB的转换:
Y = 0.299R + 0.587G + 0.114B
U = -0.1687R - 0.3313G + 0.5B + 128
V = 0.5R - 0.4187G - 0.0813B + 128

R = Y + 1.402 (V-128)
G= Y - 0.34414 (U-128) - 0.71414 (V-128)
B= Y + 1.772 (U-128)

YCbCr与RGB的相互转换

Y=0.299R+0.587G+0.114B
Cb=0.564(B-Y)
Cr=0.713(R-Y)
例如：R= 0，G = 138，B=255
Y = 0 + 81.006 + 29.07 = 110.076
Cb= 0.564*（255-110.076 = 144.924）= 81.737136
Cr= 0.713* （0-110.076 = -110.076）= -78.484188


R=Y+1.402Cr 
G=Y-0.344Cb-0.714Cr
B=Y+1.772Cb
转换回来：
R = 110.076 + 1.402* -78.484188（-110.034831576） =  0.04
G = 110.76 - 
B = 
```
下面是现在主流的 编码压缩格式（出自维基百科），从H.264开始  ITU-T 和 IEC 的两个项目开始共同维护，相当于合并.  
Year | Standard | Publisher|Popular implementations  
---|---|---|---  
1984|	H.120|	ITU-T|  
1988|	H.261|	ITU-T|	Videoconferencing, videotelephony（视频会议、可视电话）  
1993|	MPEG-1 Part 2|	ISO, IEC|	Video-CD（CD、光盘）  
1995|	H.262/MPEG-2 Part 2|	ISO, IEC, ITU-T|	DVD Video, Blu-ray, DVB, ATSC, SVCD  1996|	H.263|	ITU-T|	Videoconferencing, videotelephony, video on mobile phones (3GP)  1999|	MPEG-4 Part 2|	ISO, IEC	|Video on Internet (DivX, Xvid ...)  
2003|	H.264/MPEG-4 AVC|	ISO, IEC, ITU-T	|Blu-ray, HD DVD, DVB, ATSC, iPod Video, Apple TV, videoconferencing  
2006|	VC-1|	SMPTE	|Blu-ray, video on Internet  
2013|	H.265/MPEG-H HEVC|	ISO, IEC, ITU-T	|Ultra HD Blu-ray, DVB, ATSC 3.0, UHD streaming, High Efficiency Image Format, macOS High Sierra, iOS 11
##### 视频帧与音频帧
常见视频帧有I、P、B帧等
- I帧表示关键帧，你可以理解为这一帧画面的完整保留，解码时只需要本帧数据就可以完成（因为包含完整画面）。
- P帧表示的是这一帧和之前的一个关键帧（或P帧）的差别，解码时需要用之前缓存的画面叠加上本帧定义的差别生成最终画面。（也就是差别帧，P帧没有完整画面数据，只有与前一帧画面差别的数据。）
- B帧是双向差别帧，也就是B帧记录的是本帧与前后帧的差别（具体比较复杂，有4种情况），换言之，要解码B帧，不仅要去的之前的缓存画面，还要解码之后的画面，通过前后画面数据与本帧数据的叠加去的最终的画面。B帧压缩率高，但是解码时CPU会比较吃力。
音频帧的概念没有视频那么清晰，几率所有视频编码格式都可以简单地认为1帧就是编码后的一幅图像。但是音频帧跟编码格式相关，它是各个编码标准自己实现的。
- 对PCM（未经过编码的音频数据）来说，它根本就不需要帧的概念，根据采样率和采样精度就可以播放，比如采样率为44.1Hz，采样精度为16位音频，你可以算出比特率是4410016kb/s，每秒的音频数据是固定的4410016/8字节。
- AMR 帧比较简单，它规定每20ms的音频是1帧，每一帧音频都是独立的，有可能采用不同的编码算法以及不同的编码参数。
- MP3帧比较复杂一些，包含了更多的信息，比如采样率、比特率等各种参数。具体如下：音频数据帧个数由文件大小和帧长决定，每一帧的长度可能不固定，也可能固定，由比特率决定，每一帧又分为帧头和数据实体两部分，帧头记录了MP3的比特率、采样率、版本等信息，每一帧之间互相独立。




#### 音频编码标准
##### 音频的数字表示
数字化表示音频信号最普通的方法时用脉冲编码调制（PCM）原理将一个模拟音频信号数字化。已固定间隔对每个通道的音频信号进行采样，然后用A/D转换器将其数字化为PCM码，该码实际上是离散数字。按照奈奎斯特采样定理，如果对一个信号在固定间隔以略高于信号最高频率两倍的速率进行采样，那么本值就包含原始信号的所有信息。
人耳的动态范围大约是140dB（例如：最大能忍受的为150dB - 最小能听到的为10dB），听力带宽最高为20kHz。因此音频信号应该以至少40kHz的采样率进行采样才能获得高质量的音频。这就是CD格式采样率为44.1kHz（Android -AudioRecorder.Class 配置参数里 google 建议配置44100Hz 的原因。）的原因，这个速率比我们能听到的最高频率的两倍稍好一些。  
###### 声道
声道（Sound Channel） 是指声音在录制或播放时在不同空间位置采集或回访的相互独立的音频信号，所以声道数就是声音录制时的声音源数据或回访时响应的扬声器数量。
常见的声道有单声道、立体声道、4声道、5.1声道、7.1声道等。
- 单声道：设置一个扬声器
- 立体声道：把单声道一个扬声器扩展为左右对称的两个扬声器。声音在录制过程中被分配到两个独立的声道，从而达到了很好的声音定位效果。立体声技术广泛应用于自Sound Blaster Pro以后的大量声卡，成为了影响深远的音频标准。
- 4声道：4声道环绕规定了4个发音点，分别是前左、前右、后左、后右，听众则被包围在中间，同时还建议增加一个低音音箱，以加强对低频信号的回访处理（这也就是如今的4.1声道音箱系统广泛流行的原因）。
- 5.1声道：其实5.1声道系统来源于4.1声道系统，将环绕声道一分为二，分为左环绕和右环绕，中央位置增加重低音效果。
- 7.1声道：7.1声道系统在5.1声道系统的基础上又增加了中左和中右两个发音点。简单来说，就是在听者的周围建立起一天前后相对平衡的声场，增加了后中场声道，



- [视频编码格式](https://en.wikipedia.org/wiki/Video_coding_format)
- [视频编码格式-详细](https://en.wikipedia.org/wiki/List_of_codecs#Lossless_video_compression)
- [音频编码格式](https://en.wikipedia.org/wiki/Comparison_of_audio_coding_formats)
- [视频编码格式比较](https://en.wikipedia.org/wiki/Comparison_of_video_codecs)
- [音频编码格式比较](https://en.wikipedia.org/wiki/Comparison_of_audio_coding_formats)
- [视频容器格式](https://en.wikipedia.org/wiki/Comparison_of_video_container_formats)
- [视频容器格式比较](https://en.wikipedia.org/wiki/Comparison_of_video_container_formats)
- [视频文件格式](https://en.wikipedia.org/wiki/Video_file_format)

## 视频相关格式
### 音视频容器格式
* **** : 
* **** : 
目前我们经常见的视频格式无非就两大类:
### 影像格式（Video）
1. **AVI**
2. ****
### 流媒体格式（Stream Video）

### 
- ![image](https://github.com/WangYP90/AndroidNotes/blob/master/VideoDevelopment/img/MediaPlayer%E7%B1%BB%E4%B9%8B%E9%97%B4%E7%9A%84%E4%BE%9D%E8%B5%96%E5%9B%BE.png?raw=true)  

* 音视频解码
	* 视频像素数据YUV, Y 代表 亮度  U 和V 代表颜色.  如果只需要播放黑白,只取Y的数据播放就可以了
	* 音频采样数据PCM,44100 一秒钟有这么多采样(是人耳能察觉到最大的范围值).  

- MPEG-2-TS格式介绍
  不包含文件头.数据大小固定(188Byte) 的TS Packet 构成.  
  TS Packet ->TS Packet-> .....

- FLV 格式介绍
  包含头文件.数据由大小不固定的Tag构成.  如果播放器不做处理,在快进的时候就不知道快进到什么地方,而后视频就从头开始了.
  头文件 ->Tag(void) ->Tag(void) .....

- H.264格式介绍
  数据大小由不固定的NALU构成,   
  最常见的情况下,1个NALU存储了1帧画面的压缩编码后的数据.

- H.264 压缩方法  

- 比较复杂,包含了帧内预测（每一帧检测）、帧间预测（多个帧检测）、熵编码、环路滤波等环节构成。  

  可以将图像数据压缩100倍以上.  
音频编码
- AAC  
由数据大小不固定的ADTS构成      ADTS Pkt.....
- AC-3  
可以将音频数据压缩10倍以上
- MP3  

- WMA

格式
- 常见的响度数据格式有 RGB24, RGB32, YUV420P, YUV422P, YUV444P等. 压缩编码中一般使用的是YUV格式的像素数据,最为常见的格式为YUV420P.
- 特点
- 视频像素数据体积很大,一般情况下1小时高清视频的RGB24格式的数据体积为:
	3600*25*1920*1080*3 = 559.9GByte (假设帧率为25HZ,取样精度8bit)
- YUV格式像素数据查看工具
YUV Player



相关知识：

- [封装格式](https://en.wikipedia.org/wiki/Comparison_of_video_container_formats)
- [视频编码方式](https://en.wikipedia.org/wiki/Comparison_of_video_codecs)
- [音频编码方式](https://en.wikipedia.org/wiki/Comparison_of_audio_coding_formats)


